function ShowPayMethodDaviplata(){$(".page-error").hide(),hideAlert(),$("#page-information-daviplata").show();var a=$("#daviplataAuthorizationNumber").text();null===a||""===a?HideDaviplataCodeSectionAndRequestNewCode():$("#page-information-daviplata").hide()}function CreateDaviplataTransaction(){try{if(ValidateDocumentNumber()){payLoader(!0),daviplataDocumentNumber();var a=JSON.parse($("#thirdPartyCheckoutsInformation").val()),e={MasterLocatorId:$("#masterLocatorId").val(),Amount:parseFloat($("#amount").val()),PaymentProcessOptionType:"Daviplata",Provider:"Daviplata",SiteReturnUrl:a.Daviplata.SiteReturn,SpecificProviderDetails:"{'numeroIdentificacion':'"+$("#documentNumberDaviPlata").val()+"','tipoDocumento':'"+$("#typeDocumentDaviPlata").val()+"'}",Token:$("#token").val()};$.ajax({type:"POST",url:"/ThirdPartyCheckoutTransactions/CreateThirdPartyCheckoutTransaction",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){hideAlert(),null!=a?0==a.ResponseCode?(SaveDaviplataTransactionData(a),ShowDaviplataCodeSection(),daviplataOTP(),payLoader(!1)):(SetErrorMessageDisplayTransactionCreation(a),payLoader(!1)):ShowPaymentPageNotAvailable()},error:function(a){ShowPaymentPageNotAvailable()}})}}catch{ShowPaymentPageNotAvailable()}}function ValidateDocumentNumber(){var a=$("#documentNumberDaviPlata").val();return null===a||""===a.trim()||a.length>14||!/^\d+$/.test(a)?($("#documentNumberValidationMessageDaviPlata").show(),!1):($("#documentNumberValidationMessageDaviPlata").hide(),!0)}function SetErrorMessageDisplayTransactionCreation(a){responseError=a.ResponseMessage,"Saldo insuficiente"==responseError?showMessageAlert($("#errorMessageInsufficientBalance").val()):"PRODUCTO NO EXISTE"==responseError||"DAVIPLATA INVÁLIDO"==responseError?showMessageAlert($("#errorMessageDocumentNumber").val()):"tipo de documento vacÃ­o"==responseError?showMessageAlert($("#errorMessageDocumentType").val()):ShowPaymentPageNotAvailable()}function SaveDaviplataTransactionData(a){$("#daviplataOrder").val(a.Order),$("#daviplataReference").val(a.Reference),$("#daviplataIdSessionToken").val(a.ProviderRequestInformation.IdSessionToken),$("#daviplataAccessToken").val(a.ProviderRequestInformation.AccessToken)}function ShowDaviplataCodeSection(){$("#typeDocumentDaviPlata").prop("disabled",!0),$("#documentNumberDaviPlata").prop("disabled",!0),$("#buttonCreateDaviplataTransaction").prop("disabled",!0),$("#buttonCreateDaviplataTransaction").addClass("button--disabled"),$("#page-code-daviplata").show()}function ConfirmPurchaseDaviplata(){try{if(ValidateDaviPlataCode()){payLoader(!0);var a={MasterLocatorId:$("#masterLocatorId").val(),Order:$("#daviplataOrder").val(),Reference:$("#daviplataReference").val(),Currency:"COP",TransactionType:1,TransactionStatus:2,PaymentNotificationType:1,Amount:parseFloat($("#amount").val()),ExtraInformation:"{'IdSessionToken':'"+$("#daviplataIdSessionToken").val()+"','OTP':'"+$("#daviPlataCode").val()+"','AccessToken':'"+document.getElementById("daviplataAccessToken").value+"'}",Token:document.getElementById("token").value};$.ajax({type:"POST",url:"/ThirdPartyCheckoutTransactions/PutThirdPartyCheckoutTransaction",data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){hideAlert(),payLoader(!1),null!=a&&0==a.ResponseCode?1==a.TransactionStatus?(daviplataPay(),ShowAuthorizationNumberSection(a.AuthorizationNumber)):2==a.TransactionStatus?(SetErrorMessageAccessDeniedDaviplata(a.ResponseMessage),HideDaviplataCodeSectionAndRequestNewCode()):(showMessageAlert($("#daviplataErrorMessage").val()),HideDaviplataCodeSectionAndRequestNewCode()):ShowPaymentPageNotAvailable()},error:function(a){ShowPaymentPageNotAvailable()}})}}catch{ShowPaymentPageNotAvailable()}}function ValidateDaviPlataCode(){hideAlert();var a=$("#daviPlataCode").val();return null!==a&&""!==a.trim()&&6===a.length&&/^\d+$/.test(a)?($("#codeValidationMessageDaviPlata").hide(),!0):($("#codeValidationMessageDaviPlata").show(),!1)}function SetErrorMessageAccessDeniedDaviplata(a){"Acceso Denegado"==a?showMessageAlert($("#errorMessageOTP").val()):showMessageAlert($("#daviplataErrorMessage").val())}function ShowAuthorizationNumberSection(a){$("#daviplataAuthorizationNumber").text(a),$("#buttonCreateDaviplataTransaction").prop("disabled",!0),$("#buttonPayReservationDaviPlata").prop("disabled",!0),$("#page-information-daviplata").hide(),$("#page-code-daviplata").hide(),$("#page-authorization-number-daviplata").show()}function HideDaviplataCodeSectionAndRequestNewCode(){$("#typeDocumentDaviPlata").prop("disabled",!1),$("#documentNumberDaviPlata").prop("disabled",!1),$("#buttonCreateDaviplataTransaction").prop("disabled",!1),$("#buttonCreateDaviplataTransaction").removeClass("button--disabled"),$("#documentNumberDaviPlata").val(""),$("#daviPlataCode").val(""),$("#daviplataTyCCheckboxMessage").hide(),$("#codeValidationMessageDaviPlata").hide(),$("#page-code-daviplata").hide()}function RedirectToSiteConfirmingDaviplataPayment(){var a=JSON.parse($("#thirdPartyCheckoutsInformation").val());window.location.href=a.Daviplata.SiteReturn}function ShowPaymentPageNotAvailable(){hideAlert(),$("#page-information-daviplata").hide(),$("#page-code-daviplata").hide(),$(".page-error").show(),payLoader(!1)}jQuery("#buttonCreateDaviplataTransaction").on("click",(function(a){CreateDaviplataTransaction()})),jQuery("#buttonPayReservationDaviPlata").on("click",(function(a){ConfirmPurchaseDaviplata()})),jQuery("#buttonCompleteReservationDaviPlata").on("click",(function(a){RedirectToSiteConfirmingDaviplataPayment()}));