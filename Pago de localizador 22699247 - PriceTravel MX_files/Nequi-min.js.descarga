function GetNequiAcceptanceToken(e = "") { hideValidationMessage(), payLoader(!0); var n = JSON.parse(document.getElementById("thirdPartyCheckoutsInformation").value); $("#page-information-nequi").show(), $(".page-error").hide(); var t = { providerConfigId: n.Nequi.ThirdPartyProviderConfigId }; $.ajax({ type: "POST", url: "/ThirdPartyCheckoutTransactions/GetAcceptanceToken", data: JSON.stringify(t), dataType: "json", contentType: "application/json; charset=utf-8", success: function (e) { hideAlert(), payLoader(!1); try { if (null != e.ProviderRequestInformation.acceptanceToken && "" != e.ProviderRequestInformation.acceptanceToken) document.getElementById("aTyCNequi").href = e.ProviderRequestInformation.permalink, document.getElementById("nequiAcceptanceToken").value = e.ProviderRequestInformation.acceptanceToken; else $("#page-information-nequi").hide(), $(".page-error").show() } catch (e) { $("#page-information-nequi").hide(), $(".page-error").show() } }, error: function (e) { $("#page-information-nequi").hide(), $(".page-error").show(), payLoader(!1) } }) } function CreateNequiTransaction() { if (ValidarTelefono() && ValidarTyC()) { payLoader(!0); var e = JSON.parse(document.getElementById("thirdPartyCheckoutsInformation").value); $("#page-information-nequi").show(), $(".page-error").hide(); var n = { MasterLocatorId: document.getElementById("masterLocatorId").value, Amount: parseFloat($("#amount").val()), PaymentProcessOptionType: "Nequi", Provider: "Nequi", SiteReturnUrl: e.Nequi.SiteReturn, SpecificProviderDetails: "{'PhoneAccount':'" + document.getElementById("txtPhoneNumberNequi").value + "','AcceptanceToken':'" + document.getElementById("nequiAcceptanceToken").value + "'}" }; $.ajax({ type: "POST", url: "/ThirdPartyCheckoutTransactions/CreateThirdPartyCheckoutTransaction", data: JSON.stringify(n), dataType: "json", contentType: "application/json; charset=utf-8", success: function (e) { hideAlert(), payLoader(!1); try { 0 == e.ResponseCode ? (nequiPayIEventLog(), $("#page-information-nequi").hide(), $("#nequiLoad").show(), $("#nequiOrder").val(e.Order), $("#nequiReference").val(e.Reference), $("#btnMethodList").hide(), setTimeout(GetTransaction, 1e4)) : ($("#page-information-nequi").hide(), $(".page-error").show()) } catch (e) { $("#btnMethodList").show(), $("#page-information-nequi").hide(), $(".page-error").show(), payLoader(!1) } }, error: function (e) { $("#btnMethodList").show(), $("#page-information-nequi").hide(), $(".page-error").show(), payLoader(!1) } }) } } async function GetTransaction() { payLoader(!0); var e = { MasterLocatorId: "0", ProviderTransactionId: "", ProviderConfigId: JSON.parse(document.getElementById("thirdPartyCheckoutsInformation").value).Nequi.ThirdPartyProviderConfigId, Order: document.getElementById("nequiOrder").value, Reference: document.getElementById("nequiReference").value }; $.ajax({ type: "POST", url: "/ThirdPartyCheckoutTransactions/GetTransaction", data: JSON.stringify(e), dataType: "json", contentType: "application/json; charset=utf-8", success: function (e) { if (payLoader(!1), "APPROVED" == e.ProviderResponseCode) { var n = JSON.parse(document.getElementById("thirdPartyCheckoutsInformation").value); location.href = n.Nequi.SiteReturn } else "DECLINED" == e.ProviderResponseCode ? ($("#lblMessageError").text(document.getElementById("NequiDeclinedTransaction").value), $("#lblMessageError").show(), $("#nequiLoad").hide(), $("#nequiError").show(), $("#btnMethodList").show()) : "ERROR" == e.ProviderResponseCode ? ("Ese cliente no existe" == e.ProviderResponseMessage ? $("#lblMessageError").text(document.getElementById("NequiValidationPhoneErrorMessage").value) : $("#lblMessageError").text(document.getElementById("NequiErrorTransaction").value), $("#lblMessageError").show(), $("#nequiLoad").hide(), $("#nequiError").show(), $("#btnMethodList").show()) : setTimeout(GetTransaction, 5e3) }, error: function (e) { $("#btnMethodList").show(), payLoader(!1) } }) } function ValidarTelefono() { return /^\d{10}$/.test($("#txtPhoneNumberNequi").val()) ? ($("#sMensajeValidacionTelefonoNequi").hide(), nequiPhoneWasCapturedIEventLog(), !0) : ($("#sMensajeValidacionTelefonoNequi").show(), !1) } function ValidarTyC() { return document.getElementById("chkConfirmNequi").checked ? ($("#sMensajeValidacionNequi").hide(), nequiCheckWasCapturedIEventLog(), !0) : ($("#sMensajeValidacionNequi").show(), !1) } function hideValidationMessage() { $("#sMensajeValidacionTelefonoNequi").hide(), $("#sMensajeValidacionNequi").hide(), $("#lblMessageError").hide(), $("#txtPhoneNumberNequi").val("") } jQuery("#btnCompletarReservacionNequi").on("click", (function (e) { CreateNequiTransaction() })), document.getElementById("chkConfirmNequi") && document.getElementById("chkConfirmNequi").addEventListener("change", (e => { e.currentTarget.checked ? ($("#sMensajeValidacionNequi").hide(), document.getElementById("btnCompletarReservacionNequi").disabled = !1, document.getElementById("btnCompletarReservacionNequi").classList.remove("button--disabled")) : ($("#sMensajeValidacionNequi").show(), document.getElementById("btnCompletarReservacionNequi").disabled = !0, document.getElementById("btnCompletarReservacionNequi").classList.add("button--disabled")) }));